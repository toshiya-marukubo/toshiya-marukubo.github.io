"use strict";function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),Object.defineProperty(a,"prototype",{writable:!1}),a}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var GPUComputationRenderer=_createClass(function f(a,b,c,e){function g(a){a.defines.resolution="vec2( "+b.toFixed(1)+", "+c.toFixed(1)+" )"}function h(b,c){c=c||{};var d=new a.ShaderMaterial({uniforms:c,vertexShader:i(),fragmentShader:b});return g(d),d}function i(){return"void main()\t{\n\n\tgl_Position = vec4( position, 1.0 );\n\n}\n"}_classCallCheck(this,f),this.variables=[],this.currentTextureIndex=0;var j=a.FloatType,k=new a.Scene,l=new a.Camera;l.position.z=1;var m={passThruTexture:{value:null}},n=h(function(){return"uniform sampler2D passThruTexture;\n\nvoid main() {\n\n\tvec2 uv = gl_FragCoord.xy / resolution.xy;\n\n\tgl_FragColor = texture2D( passThruTexture, uv );\n\n}\n"}(),m),o=new a.Mesh(new a.PlaneGeometry(2,2),n);k.add(o),this.setDataType=function(a){return j=a,this},this.addVariable=function(b,c,d){var e=this.createShaderMaterial(c),f={name:b,initialValueTexture:d,material:e,dependencies:null,renderTargets:[],wrapS:null,wrapT:null,minFilter:a.NearestFilter,magFilter:a.NearestFilter};return this.variables.push(f),f},this.setVariableDependencies=function(a,b){a.dependencies=b},this.init=function(){if(!1===e.capabilities.isWebGL2&&!1===e.extensions.has("OES_texture_float"))return"No OES_texture_float support for float textures.";if(0===e.capabilities.maxVertexTextures)return"No support for vertex shader textures.";for(var k,l=0;l<this.variables.length;l++){k=this.variables[l],k.renderTargets[0]=this.createRenderTarget(b,c,k.wrapS,k.wrapT,k.minFilter,k.magFilter),k.renderTargets[1]=this.createRenderTarget(b,c,k.wrapS,k.wrapT,k.minFilter,k.magFilter),this.renderTexture(k.initialValueTexture,k.renderTargets[0]),this.renderTexture(k.initialValueTexture,k.renderTargets[1]);var a=k.material,f=a.uniforms;if(null!==k.dependencies)for(var i,m=0;m<k.dependencies.length;m++){if(i=k.dependencies[m],i.name!==k.name){for(var g=!1,h=0;h<this.variables.length;h++)if(i.name===this.variables[h].name){g=!0;break}if(!g)return"Variable dependency not found. Variable="+k.name+", dependency="+i.name}f[i.name]={value:null},a.fragmentShader="\nuniform sampler2D "+i.name+";\n"+a.fragmentShader}}return this.currentTextureIndex=0,null},this.compute=function(){for(var a,b=this.currentTextureIndex,c=0===this.currentTextureIndex?1:0,e=0,f=this.variables.length;e<f;e++){if(a=this.variables[e],null!==a.dependencies)for(var g,h=a.material.uniforms,j=0,k=a.dependencies.length;j<k;j++)g=a.dependencies[j],h[g.name].value=g.renderTargets[b].texture;this.doRenderTarget(a.material,a.renderTargets[c])}this.currentTextureIndex=c},this.getCurrentRenderTarget=function(a){return a.renderTargets[this.currentTextureIndex]},this.getAlternateRenderTarget=function(a){return a.renderTargets[0===this.currentTextureIndex?1:0]},this.addResolutionDefine=g,this.createShaderMaterial=h,this.createRenderTarget=function(d,e,f,g,h,i){d=d||b,e=e||c,f=f||a.ClampToEdgeWrapping,g=g||a.ClampToEdgeWrapping,h=h||a.NearestFilter,i=i||a.NearestFilter;var k=new a.WebGLRenderTarget(d,e,{wrapS:f,wrapT:g,minFilter:h,magFilter:i,format:a.RGBAFormat,type:j,depthBuffer:!1});return k},this.createTexture=function(){var d=new Float32Array(4*(b*c));return new a.DataTexture(d,b,c,a.RGBAFormat,a.FloatType)},this.renderTexture=function(a,b){m.passThruTexture.value=a,this.doRenderTarget(n,b),m.passThruTexture.value=null},this.doRenderTarget=function(a,b){var c=e.getRenderTarget();o.material=a,e.setRenderTarget(b),e.render(k,l),o.material=n,e.setRenderTarget(c)}});