"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),Object.defineProperty(a,"prototype",{writable:!1}),a}var vertexShader="\nuniform float uTime;\nfloat PI = 3.14159265359;\nvarying vec3 vPosition;\n\nvoid main(){\n\n  vec3 pos = position;\n  pos.x = position.x * cos(uTime * 0.3) - position.y * sin(uTime * 0.3);\n  pos.y = position.x * sin(uTime * 0.3) + position.y * cos(uTime * 0.3);\n  \n  float q = sin(cos(position.z * sin(uTime * 0.1) * 12.0) - uTime);\n  \n  pos.x = pos.x * q;\n  pos.y = pos.y * q;\n  pos.z = tan(uTime * 0.3 * q) * 0.1;\n  \n  vec4 mvPosition = modelViewMatrix * vec4(pos, 1.0);\n  \n  vPosition = pos;\n  \n  gl_PointSize = 2.0 * (14.0 / - mvPosition.z);\n  gl_Position = projectionMatrix * mvPosition;\n}\n",fragmentShader="\nuniform float uTime;\nvarying vec3 vPosition;\n\n// Reference\n// https://iquilezles.org/www/articles/palettes/palettes.htm\n// Thank you so much.\nvec3 palette( in float t, in vec3 a, in vec3 b, in vec3 c, in vec3 d ) {\n  return a + b*cos( 6.28318*(c*t+d) );\n}\n\nvoid main () {\n  // Reference\n  // https://qiita.com/uma6661/items/20accc9b5fb9845fc73a\n  // Thank you so much.\n  float f = length(gl_PointCoord - vec2(0.5, 0.5));\n  if ( f > 0.1 ) discard;\n  \n  vec3 color =\n    palette(\n      length(vPosition) - uTime * 0.5, \n      vec3(0.5,0.5,0.5),\n      vec3(0.5,0.5,0.5),\n      vec3(1.0,1.0,1.0),\n      vec3(0.0,0.33,0.67)\n    );\n  \n  gl_FragColor = vec4(color, 1.0);\n}\n",Mouse=function(){function a(b){_classCallCheck(this,a),this.sketch=b,this.initialize()}return _createClass(a,[{key:"initialize",value:function initialize(){this.delta=0,this.mouse=new THREE.Vector3,this.setupEvents()}},{key:"setupEvents",value:function setupEvents(){window.addEventListener("scroll",this.onScroll.bind(this),!1),window.addEventListener("mousemove",this.onMousemove.bind(this),!1),window.addEventListener("touchmove",this.onTouchmove.bind(this),!1)}},{key:"onScroll",value:function onScroll(){var a=window.pageYOffset,b=document.body.scrollHeight-window.innerHeight;this.delta=a/b}},{key:"onMousemove",value:function onMousemove(a){this.mouse.x=2*(a.clientX/window.innerWidth)-1,this.mouse.y=2*-(a.clientY/window.innerHeight)+1,this.mouse.z=1}},{key:"onTouchmove",value:function onTouchmove(a){var b=a.targetTouches[0];this.mouse.x=2*(b.pageX/window.innerWidth)-1,this.mouse.y=2*-(b.pageY/window.innerHeight)+1,this.mouse.z=1}}]),a}(),Sketch=function(){function a(){_classCallCheck(this,a),this.createCanvas(),this.setupEvents(),this.time=new THREE.Clock(!0),this.mouse=new Mouse(this),this.initialize()}return _createClass(a,[{key:"createCanvas",value:function createCanvas(){this.renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!0}),document.body.appendChild(this.renderer.domElement)}},{key:"setupEvents",value:function setupEvents(){window.addEventListener("resize",this.onResize.bind(this),!1)}},{key:"onResize",value:function onResize(){this.preWidth===window.innerWidth&&480>window.innerWidth||this.initialize()}},{key:"initialize",value:function initialize(){this.animationId&&cancelAnimationFrame(this.animationId),this.preWidth=this.width=Math.ceil(window.innerWidth),this.height=Math.ceil(window.innerHeight),this.scene=new THREE.Scene,this.setupCanvas(),this.setupCamera(),this.setupShape(),this.draw()}},{key:"setupCanvas",value:function setupCanvas(){this.renderer.setSize(this.width,this.height),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setClearColor("#0a0927",1),this.renderer.domElement.style.position="fixed",this.renderer.domElement.style.top="0",this.renderer.domElement.style.left="0",this.renderer.domElement.style.width="100%",this.renderer.domElement.style.height="100%",this.renderer.domElement.style.zIndex="-1",this.renderer.domElement.style.outline="none"}},{key:"setupCamera",value:function setupCamera(){var a=35*(Math.PI/180);this.dist=this.height/2/Math.tan(a),this.camera=new THREE.PerspectiveCamera(70,this.width/this.height,.01,4),this.cameraV=new THREE.Vector3,this.cameraP=new THREE.Vector3(0,0,2),this.camera.position.set(this.cameraP),this.camera.lookAt(new THREE.Vector3),this.scene.add(this.camera)}},{key:"updateCamera",value:function updateCamera(){this.cameraV.subVectors(this.mouse.mouse,this.cameraP).multiplyScalar(.05),this.cameraP.add(this.cameraV),this.camera.position.set(2*this.cameraP.x,2*this.cameraP.y,2),this.camera.lookAt(new THREE.Vector3)}},{key:"setupLight",value:function setupLight(){this.directionalLight=new THREE.DirectionalLight(16777215),this.scene.add(this.directionalLight),this.spotLight=new THREE.SpotLight(16777215),this.spotLight.position.set(0,0,2),this.scene.add(this.spotLight)}},{key:"setupShape",value:function setupShape(){this.shape=new Shape(this,0,0,0)}},{key:"draw",value:function draw(){var a=this.time.getElapsedTime();this.shape.render(a),this.updateCamera(a),this.renderer.render(this.scene,this.camera),this.animationId=requestAnimationFrame(this.draw.bind(this))}}]),a}(),Shape=function(){function a(b){_classCallCheck(this,a),this.sketch=b,this.setupSizes(),this.init()}return _createClass(a,[{key:"setupSizes",value:function setupSizes(){this.count=null,768>this.sketch.width&&(this.count=5e3),768<=this.sketch.width&&(this.count=2e4)}},{key:"init",value:function init(){this.geometry=new THREE.BufferGeometry,this.vertices=new Float32Array(3*this.count);for(var d=0;d<3*this.count;d++){var a=2*Math.PI/this.count*(3*d),b=Math.cos(a),c=Math.sin(a);this.vertices[3*d+0]=b,this.vertices[3*d+1]=c,this.vertices[3*d+2]=Math.atan2(c,b)}this.geometry.setAttribute("position",new THREE.BufferAttribute(this.vertices,3)),this.material=new THREE.ShaderMaterial({side:THREE.DoubleSide,uniforms:{uTime:{type:"f",value:0}},blending:THREE.AdditiveBlending,transparent:!0,vertexShader:vertexShader,fragmentShader:fragmentShader}),this.mesh=new THREE.Points(this.geometry,this.material),this.sketch.scene.add(this.mesh)}},{key:"render",value:function render(a){this.mesh.material.uniforms.uTime.value=a}}]),a}();(function(){window.addEventListener("load",function(){new Loading("loading","loaded"),new FullScreen,new Sketch})})();