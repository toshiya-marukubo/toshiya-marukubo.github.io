"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),Object.defineProperty(a,"prototype",{writable:!1}),a}var vertexSphereShader="\nuniform float uTime;\nuniform float mouse;\nvarying vec2 vUv;\nfloat PI = 3.14159265359;\n\n// Reference\n// https://gist.github.com/patriciogonzalezvivo/670c22f3966e662d2f83\n// Thank you so much.\nfloat mod289(float x){return x - floor(x * (1.0 / 289.0)) * 289.0;}\nvec4 mod289(vec4 x){return x - floor(x * (1.0 / 289.0)) * 289.0;}\nvec4 perm(vec4 x){return mod289(((x * 34.0) + 1.0) * x);}\n\nfloat noise(vec3 p){\n    vec3 a = floor(p);\n    vec3 d = p - a;\n    d = d * d * (3.0 - 2.0 * d);\n\n    vec4 b = a.xxyy + vec4(0.0, 1.0, 0.0, 1.0);\n    vec4 k1 = perm(b.xyxy);\n    vec4 k2 = perm(k1.xyxy + b.zzww);\n\n    vec4 c = k2 + a.zzzz;\n    vec4 k3 = perm(c);\n    vec4 k4 = perm(c + 1.0);\n\n    vec4 o1 = fract(k3 * (1.0 / 41.0));\n    vec4 o2 = fract(k4 * (1.0 / 41.0));\n\n    vec4 o3 = o2 * d.z + o1 * (1.0 - d.z);\n    vec2 o4 = o3.yw * d.x + o3.xz * (1.0 - d.x);\n\n    return o4.y * d.y + o4.x * (1.0 - d.y);\n}\n\nvoid main(){\n  float noisy = mouse * pow(noise(normal * 2.0 + uTime * 10.0), 2.0);\n  \n  vec3 newPosition = position + noisy * normal * 100.0;\n \n  vec4 mvPosition = modelViewMatrix * vec4(newPosition, 1.0);\n  \n  vUv = uv;\n  \n  gl_Position = projectionMatrix * mvPosition;\n}\n\n",fragmentSphereShader="\nuniform float uTime;\nuniform sampler2D uTexture;\nvarying vec2 vUv;\n\nvoid main () {\n  vec4 color = texture2D(uTexture, vUv);\n  \n  gl_FragColor = vec4(color / 3.0);\n}\n",vertexFloorShader="\nuniform float uTime;\nuniform float mouse;\nvarying vec2 vUv;\nfloat PI = 3.14159265359;\n\n// Reference\n// https://gist.github.com/patriciogonzalezvivo/670c22f3966e662d2f83\n// Thank you so much.\nfloat mod289(float x){return x - floor(x * (1.0 / 289.0)) * 289.0;}\nvec4 mod289(vec4 x){return x - floor(x * (1.0 / 289.0)) * 289.0;}\nvec4 perm(vec4 x){return mod289(((x * 34.0) + 1.0) * x);}\n\nfloat noise(vec3 p){\n    vec3 a = floor(p);\n    vec3 d = p - a;\n    d = d * d * (3.0 - 2.0 * d);\n\n    vec4 b = a.xxyy + vec4(0.0, 1.0, 0.0, 1.0);\n    vec4 k1 = perm(b.xyxy);\n    vec4 k2 = perm(k1.xyxy + b.zzww);\n\n    vec4 c = k2 + a.zzzz;\n    vec4 k3 = perm(c);\n    vec4 k4 = perm(c + 1.0);\n\n    vec4 o1 = fract(k3 * (1.0 / 41.0));\n    vec4 o2 = fract(k4 * (1.0 / 41.0));\n\n    vec4 o3 = o2 * d.z + o1 * (1.0 - d.z);\n    vec2 o4 = o3.yw * d.x + o3.xz * (1.0 - d.x);\n\n    return o4.y * d.y + o4.x * (1.0 - d.y);\n}\n\nvoid main(){\n  float noisy = mouse * pow(noise(normal + position.y * position.x +  uTime * 10.0), 2.0);\n  \n  vec3 newPosition = position + noisy * 2.0 * normal * 300.0;\n \n  vec4 mvPosition = modelViewMatrix * vec4(newPosition, 1.0);\n  \n  vUv = uv;\n  \n  gl_Position = projectionMatrix * mvPosition;\n}\n\n",fragmentFloorShader="\nuniform float uTime;\nuniform sampler2D uTexture;\nvarying vec2 vUv;\n\nvoid main () {\n  vec4 color = texture2D(uTexture, vUv);\n  \n  gl_FragColor = vec4(color / 3.0);\n}\n",Mouse=function(){function a(b){_classCallCheck(this,a),this.sketch=b,this.initialize()}return _createClass(a,[{key:"initialize",value:function initialize(){this.delta=0,this.mouse=new THREE.Vector3,this.setupEvents(),this.lastX=0,this.lastY=0,this.speed=0}},{key:"setupEvents",value:function setupEvents(){window.addEventListener("scroll",this.onScroll.bind(this),!1),window.addEventListener("mousemove",this.onMousemove.bind(this),!1),window.addEventListener("touchmove",this.onTouchmove.bind(this),!1)}},{key:"onScroll",value:function onScroll(){var a=window.pageYOffset,b=document.body.scrollHeight-window.innerHeight;this.delta=a/b}},{key:"onMousemove",value:function onMousemove(a){this.mouse.x=2*(a.clientX/window.innerWidth)-1,this.mouse.y=2*-(a.clientY/window.innerHeight)+1,this.mouse.z=0,this.speed=.1*Math.sqrt(Math.pow(a.pageX-this.lastX,2)+Math.pow(a.pageY-this.lastY,2)),this.lastX=a.pageX,this.lastY=a.pageY}},{key:"onTouchmove",value:function onTouchmove(a){var b=a.targetTouches[0];this.mouse.x=2*(b.pageX/window.innerWidth)-1,this.mouse.y=2*-(b.pageY/window.innerHeight)+1,this.mouse.z=0,this.speed=.5*Math.sqrt(Math.pow(b.pageX-this.lastX,2)+Math.pow(b.pageY-this.lastY,2)),this.lastX=b.pageX,this.lastY=b.pageY}}]),a}(),Sketch=function(){function a(){_classCallCheck(this,a),this.createCanvas(),this.setupEvents(),this.time=new THREE.Clock(!0),this.mouse=new Mouse(this),this.initialize()}return _createClass(a,[{key:"createCanvas",value:function createCanvas(){this.renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!0}),document.body.appendChild(this.renderer.domElement)}},{key:"setupEvents",value:function setupEvents(){window.addEventListener("resize",this.onResize.bind(this),!1)}},{key:"onResize",value:function onResize(){this.preWidth===window.innerWidth&&480>window.innerWidth||this.initialize()}},{key:"initialize",value:function initialize(){this.animationId&&cancelAnimationFrame(this.animationId),this.preWidth=this.width=Math.ceil(window.innerWidth),this.height=Math.ceil(window.innerHeight),this.scene=new THREE.Scene,this.setupCanvas(),this.setupCamera(),this.setupLight(),this.setupShape(),this.draw()}},{key:"setupCanvas",value:function setupCanvas(){this.renderer.setSize(this.width,this.height),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setClearColor("#D7D6DA",1),this.renderer.domElement.style.position="fixed",this.renderer.domElement.style.top="0",this.renderer.domElement.style.left="0",this.renderer.domElement.style.width="100%",this.renderer.domElement.style.height="100%",this.renderer.domElement.style.zIndex="-1",this.renderer.domElement.style.outline="none"}},{key:"setupCamera",value:function setupCamera(){var a=25*(Math.PI/180);this.dist=this.height/2/Math.tan(a),this.camera=new THREE.PerspectiveCamera(50,this.width/this.height,.01,10*this.dist),this.cameraV=new THREE.Vector3,this.cameraP=new THREE.Vector3(0,0,this.dist),this.camera.position.set(this.cameraP.x,this.cameraP.y,this.cameraP.z),this.camera.lookAt(new THREE.Vector3),this.scene.add(this.camera)}},{key:"updateCamera",value:function updateCamera(){this.cameraV.subVectors(this.mouse.mouse,this.cameraP).multiplyScalar(.05),this.cameraP.add(this.cameraV),this.camera.position.set(this.cameraP.x*this.dist,Math.max(this.cameraP.y*this.dist,-200),this.dist),this.camera.lookAt(new THREE.Vector3)}},{key:"setupLight",value:function setupLight(){this.directionalLight=new THREE.DirectionalLight(16777215),this.scene.add(this.directionalLight),this.spotLight=new THREE.SpotLight(16777215),this.spotLightV=new THREE.Vector3,this.spotLightP=new THREE.Vector3(0,0,.1*this.dist),this.spotLight.position.set(this.spotLightP.x,this.spotLightP.y,this.spotLightP.z),this.spotLight.lookAt(new THREE.Vector3),this.scene.add(this.spotLight)}},{key:"updateLight",value:function updateLight(){this.spotLightV.subVectors(this.mouse.mouse,this.spotLightP).multiplyScalar(.05),this.spotLightP.add(this.spotLightV),this.spotLight.position.set(this.spotLightP.x*this.dist,this.spotLightP.y*this.dist,this.dist),this.spotLight.lookAt(new THREE.Vector3)}},{key:"setupShape",value:function setupShape(){this.shape=new Shape(this,0,0,0)}},{key:"draw",value:function draw(){var a=this.time.getElapsedTime();this.shape.render(.1*a),this.updateCamera(a),this.updateLight(a),this.renderer.render(this.scene,this.camera),this.animationId=requestAnimationFrame(this.draw.bind(this))}}]),a}(),Shape=function(){function a(b,c,d,e){_classCallCheck(this,a),this.sketch=b,this.beta=0,this.position=new THREE.Vector3(c,d,e),this.setupSizes(),this.initialize()}return _createClass(a,[{key:"setupSizes",value:function setupSizes(){this.sphereSize=null,this.floorSize=Math.max(5*this.sketch.width,5*this.sketch.height),768>this.sketch.width&&(this.sphereSize=120),768<=this.sketch.width&&(this.sphereSize=192)}},{key:"initialize",value:function initialize(){this.createTexture(),this.floorGeometry=new THREE.PlaneGeometry(this.floorSize,this.floorSize,128,128),this.floorMaterial=new THREE.ShaderMaterial({side:THREE.DoubleSide,uniforms:{uTime:{type:"f",value:0},mouse:{type:"f",value:0},uTexture:{type:"t",value:this.returnTexture()}},vertexShader:vertexFloorShader,fragmentShader:fragmentFloorShader}),this.floorMesh=new THREE.Mesh(this.floorGeometry,this.floorMaterial),this.floorMesh.position.set(0,-this.sketch.height/3,0),this.floorMesh.rotation.x=Math.PI/2,this.sketch.scene.add(this.floorMesh),this.sphereGeometry=new THREE.SphereGeometry(this.sphereSize,64,64),this.sphereMaterial=new THREE.ShaderMaterial({side:THREE.DoubleSide,uniforms:{uTime:{type:"f",value:0},mouse:{type:"f",value:0},uTexture:{type:"t",value:this.returnTexture()}},vertexShader:vertexSphereShader,fragmentShader:fragmentSphereShader}),this.sphereMeshV=new THREE.Vector3,this.sphereMeshP=new THREE.Vector3(0,-2e3,0),this.sphereMesh=new THREE.Mesh(this.sphereGeometry,this.sphereMaterial),this.sphereMesh.position.set(this.sphereMeshP.x,this.sphereMeshP.y,this.sphereMeshP.z),this.sphereMesh.rotation.y=-Math.PI/2,this.sketch.scene.add(this.sphereMesh)}},{key:"createTexture",value:function createTexture(){this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.length=256,this.canvas.width=this.length,this.canvas.height=this.length,this.plasma=new Plasma(this.ctx,this.length,this.length),this.texture=new THREE.CanvasTexture(this.canvas)}},{key:"returnTexture",value:function returnTexture(){return this.texture}},{key:"updateTexture",value:function updateTexture(a){this.plasma.render(10*a)}},{key:"render",value:function render(a){this.sphereMeshV.subVectors(new THREE.Vector3,this.sphereMeshP).multiplyScalar(.05),this.sphereMeshP.add(this.sphereMeshV),this.sphereMesh.position.set(this.sphereMeshP.x,this.sphereMeshP.y,this.sphereMeshP.z),this.beta-=.05*(this.beta-this.sketch.mouse.speed),this.sketch.mouse.speed*=.99,this.texture.needsUpdate=!0,this.updateTexture(a),this.sphereMesh.material.uniforms.uTime.value=a,this.sphereMesh.material.uniforms.mouse.value=this.beta,this.floorMesh.material.uniforms.uTime.value=a,this.floorMesh.material.uniforms.mouse.value=this.beta}}]),a}(),Plasma=function(){function a(b,c){_classCallCheck(this,a),this.ctx=b,this.size=c,this.mapSize=2*this.size,this.initialize()}return _createClass(a,[{key:"initialize",value:function initialize(){this.prevDirection=1,this.dx1=0,this.dy1=0,this.dx2=0,this.dy2=0,this.heightMap1=[],this.heightMap2=[],this.palette=[],this.palettes=[this.makeRandomPalette(),this.makeRandomPalette()],this.image=this.ctx.createImageData(this.size,this.size),this.getImageData(),this.getHeightMap()}},{key:"getImageData",value:function getImageData(){for(var a=0;a<this.image.data.length;a+=4)this.image.data[a+0]=0,this.image.data[a+1]=0,this.image.data[a+2]=0,this.image.data[a+3]=255}},{key:"distance",value:function distance(a,b){return Math.sqrt(a*a+b*b)}},{key:"randomColor",value:function randomColor(){var a=Math.floor(255*Math.random()),c=Math.floor(255*Math.random()),d=Math.floor(255*Math.random());return{r:a,g:c,b:d}}},{key:"updatePalette",value:function updatePalette(a){var b=(Math.cos(a)+1)/2,c=0<=Math.sin(a)?-1:1;this.prevDirection!=c&&(this.prevDirection=c,-1==c?this.palettes[0]=this.makeRandomPalette():this.palettes[1]=this.makeRandomPalette());for(var d=0;256>d;d++)this.palette[d]=this.interpolate(this.palettes[0][d],this.palettes[1][d],b)}},{key:"makeRandomPalette",value:function makeRandomPalette(){var a=this.randomColor(),b=this.randomColor(),c=this.randomColor(),d=this.randomColor(),e=this.randomColor();return this.makeFiveColorGradient(a,b,c,d,e)}},{key:"interpolate",value:function interpolate(a,b,c){return{r:Math.floor(a.r+(b.r-a.r)*c),g:Math.floor(a.g+(b.g-a.g)*c),b:Math.floor(a.b+(b.b-a.b)*c)}}},{key:"makeFiveColorGradient",value:function makeFiveColorGradient(a,b,c,d,e){for(var h,j=[],g=0;64>g;g++)h=g/64,j[g]=this.interpolate(a,b,h);for(var k,l=64;128>l;l++)k=(l-64)/64,j[l]=this.interpolate(b,c,k);for(var m,n=128;192>n;n++)m=(n-128)/64,j[n]=this.interpolate(c,d,m);for(var o,p=192;256>p;p++)o=(p-192)/64,j[p]=this.interpolate(d,e,o);return j}},{key:"getHeightMap",value:function getHeightMap(){for(var c=0;c<this.mapSize;c++)for(var o=0;o<this.mapSize;o++){var a=c*this.mapSize+o,b=c-this.mapSize/2,e=o-this.mapSize/2,f=this.distance(b,e),d=2*Math.PI/(this.mapSize/2),g=Math.sin(f*d);this.heightMap1[a]=Math.floor(128*((g+1)/2))}for(var p=0;p<this.mapSize;p++)for(var q=0;q<this.mapSize;q++){var h=p*this.mapSize+q,i=p-this.mapSize/2,j=q-this.mapSize/2,k=.1*this.distance(i,j),l=.02*this.distance(i,j),m=Math.sin(k),n=Math.cos(l);this.heightMap2[h]=Math.floor(127*((m+n+2)/4))}}},{key:"moveHeightMap",value:function moveHeightMap(a){this.dx1=Math.floor((Math.cos(.5*a)+1)/2*this.mapSize/2),this.dy1=Math.floor((Math.sin(.2*a)+1)/2*this.mapSize/2),this.dx2=Math.floor((Math.cos(.3*a)+1)/2*this.mapSize/2),this.dy2=Math.floor((Math.sin(.4*a)+1)/2*this.mapSize/2)}},{key:"updateImageData",value:function updateImageData(){for(var c=0;c<this.size;c++)for(var g=0;g<this.size;g++){var a=(c+this.dy1)*this.mapSize+(g+this.dx1),b=(c+this.dy2)*this.mapSize+(g+this.dx2),d=4*(c*this.size)+4*g,e=this.heightMap1[a]+this.heightMap2[b],f=this.palette[e];this.image.data[d]=f.r,this.image.data[d+1]=f.g,this.image.data[d+2]=f.b}}},{key:"drawImageData",value:function drawImageData(){this.ctx.putImageData(this.image,0,0)}},{key:"render",value:function render(a){this.ctx.clearRect(0,0,this.size,this.size),this.moveHeightMap(a),this.updatePalette(2*a),this.updateImageData(),this.drawImageData()}}]),a}();(function(){window.addEventListener("load",function(){new Loading("loading","loaded"),new FullScreen,new Sketch})})();
